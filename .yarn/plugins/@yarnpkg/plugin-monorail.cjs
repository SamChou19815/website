/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-monorail",
factory: function (require) {
var plugin;(()=>{"use strict";var n={904:(n,e,r)=>{r.d(e,{Z:()=>i});var o=r(129);const t=(()=>{const n=new Map,e=`[${(0,o.spawnSync)("yarn",["workspaces","list","-v","--json"]).stdout.toString().trim().split("\n").join(",")}]`,r=JSON.parse(e),t={};return r.forEach(({name:n,location:e})=>{null!=n&&(t[e]=n)}),r.forEach(({name:e,location:r,workspaceDependencies:o})=>{null!=e&&n.set(e,{workspaceLocation:r,dependencies:o.map(n=>{const e=t[n];if(null==e)throw new Error(`Bad dependency of ${e}: ${n}`);return e})})}),n})(),a=n=>{const e=[],r=[],o=new Set,a=new Set,i=s=>{var l;if(a.has(s)){if(!o.has(s))return;r.push(s);const n=r.indexOf(s),e=r.slice(n,r.length).join(" -> ");throw new Error("Cyclic dependency detected: "+e)}const c=null===(l=t.get(s))||void 0===l?void 0:l.dependencies;if(null==c)throw new Error(`Workspace ${n} is not found!`);a.add(s),r.push(s),o.add(s),c.forEach(i),o.delete(s),r.pop(),e.push(s)};return i(n),e},i={__type__:"@generated",information:Object.fromEntries(Array.from(t.entries()).map(([n,{dependencies:e,...r}])=>[n,{...r,dependencyChain:a(n)}]).sort(([n],[e])=>n.localeCompare(e))),topologicallyOrdered:(()=>{const n=[],e=new Set;return Array.from(t.keys()).forEach(r=>{a(r).forEach(r=>{e.has(r)||(n.push(r),e.add(r))})}),n})()}},129:n=>{n.exports=require("child_process")}},e={};function r(o){var t=e[o];if(void 0!==t)return t.exports;var a=e[o]={exports:{}};return n[o](a,a.exports,r),a.exports}r.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return r.d(e,{a:e}),e},r.d=(n,e)=>{for(var o in e)r.o(e,o)&&!r.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:e[o]})},r.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),r.r=n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var o={};(()=>{r.r(o),r.d(o,{default:()=>S});const n=require("fs"),e=require("clipanion"),t=require("path"),a='\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n        with:\n          fetch-depth: "2"\n      - uses: actions/setup-node@v2\n      - uses: actions/cache@v2\n        with:\n          path: ".yarn/cache\\n.pnp.js"\n          key: "yarn-berry-${{ hashFiles(\'**/yarn.lock\') }}"\n          restore-keys: "yarn-berry-"\n      - name: Yarn Install\n        run: yarn install --immutable',i=e=>[[".github/workflows/generated-general.yml",`# @generated\n\nname: General\non:\n  push:\n    branches:\n      - main\n  pull_request:\n\njobs:\n  lint:${a}\n      - name: Format Check\n        run: yarn format:check\n      - name: Lint\n        run: yarn lint\n  build:${a}\n      - name: Compile\n        run: yarn c\n  validate:${a}\n      - name: Check changed\n        run: if [[ \`git status --porcelain\` ]]; then exit 1; fi\n  test:${a}\n      - name: Test\n        run: yarn test\n`],...e.topologicallyOrdered.filter(r=>((e,r,o)=>{var a,i;const s=e.information[r];if(null==s)throw new Error;return null!=(null===(i=null===(a=JSON.parse((0,n.readFileSync)((0,t.join)(s.workspaceLocation,"package.json")).toString()))||void 0===a?void 0:a.scripts)||void 0===i?void 0:i[o])})(e,r,"deploy")).map(n=>{var r,o;return[`.github/workflows/generated-${"cd-"+n}.yml`,`# @generated\n\nname: CD ${n}\non:\n  push:\n    paths:${(null!==(o=null===(r=e.information[n])||void 0===r?void 0:r.dependencyChain)&&void 0!==o?o:[]).map(n=>{var r;return`\n      - '${null===(r=e.information[n])||void 0===r?void 0:r.workspaceLocation}/**'`}).join("")}\n      - 'configuration/**'\n      - '.github/workflows/generated-*-${n}.yml'\n    branches:\n      - main\nenv:\n  NETLIFY_AUTH_TOKEN: \${{ secrets.NETLIFY_AUTH_TOKEN }}\n\njobs:\n  deploy:${a}\n      - name: Build\n        run: yarn workspace ${n} build\n      - name: Deploy\n        run: yarn workspace ${n} deploy\n`]})],s=(0,t.join)(".github","workflows"),l=async e=>{(0,n.existsSync)(s)&&(0,n.readdirSync)(s).forEach(e=>{e.startsWith("generated-")&&(0,n.unlinkSync)((0,t.join)(s,e))}),(0,n.mkdirSync)(s,{recursive:!0}),i(e).forEach(([e,r])=>{(0,n.writeFileSync)(e,r)})};var c=r(129);const d=n=>process.stderr.isTTY?e=>`[${n}m${e}[0m`:n=>n,u=d(31),p=d(32),m=d(33),y=d(34),h=d(35),f=(d(36),["â ‹","â ™","â ¹","â ¸","â ¼","â ´","â ¦","â §","â ‡","â "]),v=n=>{let e=0;const r=(new Date).getTime();return setInterval(()=>{const o=(((new Date).getTime()-r)/1e3).toFixed(1)+"s",t=n(o),a=f[e%10];process.stderr.write(m(`${t} ${a}\r`)),e+=1},process.stderr.isTTY?40:1e3)},w=(n,e)=>{var r,o;const a=r=>{var o,a;return(0,t.dirname)(r)!==(0,t.join)(null!==(a=null===(o=n.information[e])||void 0===o?void 0:o.workspaceLocation)&&void 0!==a?a:".","bin")};return(null!==(o=null===(r=n.information[e])||void 0===r?void 0:r.dependencyChain)&&void 0!==o?o:[]).some(e=>{var r,o;return(n=>{const e=(e,r)=>{const o=(0,c.spawnSync)("git",["diff",e,...r?[r]:[],"--name-only","--",n]).stdout.toString().trim();return""===o?[]:o.split("\n")};return process.env.CI?e("HEAD^","HEAD"):e("origin/main")})(null!==(o=null===(r=n.information[e])||void 0===r?void 0:r.workspaceLocation)&&void 0!==o?o:".").some(a)})},g=async()=>{var e;const r=(n=>n.topologicallyOrdered.map(e=>[e,w(n,e)]).filter(([,n])=>n).map(([n])=>n))((e="workspaces.json",JSON.parse((0,n.readFileSync)(e).toString())));r.forEach(n=>{console.error(y(`[i] \`${n}\` needs to be recompiled.`))});const o=v(n=>`[?] Compiling (${n})`),t=Promise.all(r.map(n=>{const e=(0,c.spawn)("yarn",["workspace",n,"compile"],{shell:!0,stdio:["ignore","pipe","ignore"]});let r="";return e.stdout.on("data",n=>{r+=n.toString()}),new Promise(o=>{e.on("exit",e=>o([n,0===e,r]))})})),a=await t;clearInterval(o);const i=a.map(n=>n[2]).join(""),s=a.filter(n=>!n[1]).map(n=>n[0]);return 0===s.length?(console.error(p("[âœ“] All workspaces have been successfully compiled!")),!0):(console.error(h("[!] Compilation finished with some errors.")),console.error(i.trim()),s.forEach(n=>{console.error(u(`[x] \`${n}\` failed to exit with 0.`))}),!1)};class k extends e.Command{async execute(){return await g()?0:1}}k.addPath("c");const S={hooks:{afterAllInstalled:()=>{const e=r(904).Z;(0,n.writeFileSync)("workspaces.json",JSON.stringify(e,void 0,2)+"\n"),l(e)}},commands:[k]}})(),plugin=o})();
return plugin;
}
};